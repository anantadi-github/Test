server {
  listen 80;
  server_name _;

  location /hls/ {
    alias /usr/share/nginx/html/hls/;

    # MIME types
    types {
      application/vnd.apple.mpegurl m3u8;
      application/x-mpegURL m3u8;
      video/mp2t ts;
    }

    # Live HLS: disable caching
    add_header Cache-Control "no-cache, no-store, must-revalidate" always;
    add_header Pragma "no-cache" always;
    add_header Expires "0" always;

    # CORS
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
    add_header Access-Control-Allow-Headers "*" always;

    # Handle preflight
    if ($request_method = OPTIONS) {
      add_header Content-Length 0;
      add_header Content-Type text/plain;
      return 204;
    }

    # Prevent partial playlist/segment edge cases
    sendfile off;

    # Better for streaming
    tcp_nodelay on;

    # Debug only (turn off later)
    autoindex on;
  }
}
